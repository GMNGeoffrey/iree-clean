---
layout: default
permalink: Dialects/ShapeDialect
parent: Dialect Definitions
title: "'shapex' Dialect"
---

<!-- Autogenerated by mlir-tblgen; don't manually edit -->
# 'shapex' Dialect
{: .no_toc }


A dialect of helper ops for shapifying computations.

1. TOC
{:toc}

## Operation definition

### `shapex.cast_compatible_shape` (Shape::CastCompatibleShapeOp)

Casts and asserts that one or more shapes are compatible.

Syntax:

```
operation ::= `shapex.cast_compatible_shape` operands `:` type(operands) `->` type($result) attr-dict
```


In the most general case, each operand and the result can have different
shapes, so long as:
  a) The operand shapes are co-compatible (known dimensions are equal
     or unknown).
  b) The result shape is at least as general as the operand shapes.

TODO: This op is currently very conservative, statically verifying that
all of the shapes are strictly the same.

Usage:
  %0 = shape.cast_compatible_shape %1, ... %3 :
      !shape.ranked_shape<...>...

#### Operands:

| Operand | Description |
| :-----: | ----------- |
`operands` | Ranked shape type

#### Results:

| Result | Description |
| :----: | ----------- |
`result` | Ranked shape type

### `shapex.const_ranked_shape` (Shape::ConstRankedShapeOp)

A constant ranked_shape.

Syntax:

```
operation ::= `shapex.const_ranked_shape` attr-dict `:` type($result)
```


Holds a RankedShape value. Note that it is only legal to store a constant
RankedShape that is fully static, as anything more specific should be
in the type, not have dims represented as const SSA values.

Usage:
  %0 = shape.const_ranked_shape : !shape.ranked_shape<[1,2]>

#### Results:

| Result | Description |
| :----: | ----------- |
`result` | Ranked shape type

### `shapex.get_ranked_shape` (Shape::GetRankedShapeOp)

Gets the RankedShape associated with the given Tensor.

Syntax:

```
operation ::= `shapex.get_ranked_shape` $operand attr-dict `:` type($operand) `->` type($shape)
```


Early in compilation, this op is used to resolve the RankedShape from an
arbitrary tensor value. It will typically be converted later to a
RankedShape loaded from an appropriate computation.

Getting the RankedShape of a statically shaped tensor will canonicalize
to a static_ranked_shape op and will never cause a further SSA dependency.

Usage:
  %0 = shape.get_ranked_shape %arg0 : tensor<2x?xf32> ->
      !shape.ranked_shape<[2,?]>  // based on index type
  %0 = shape.get_ranked_shape %arg0 : tensor<2x?xf32> ->
      !shape.ranked_shape<[2,?],i32>  // explicit dim type

Canonicalization: This op includes a canonicalization pattern such that
if its operand is supplied by a tie_shape op, then it will replace itself
with the tie_shape's shape() operand. In this way, a function with all
shapes materialized and tied to intermediate tensors should canonicalize
to contain no get_ranked_shape ops.

Any get_ranked_shape on a fully static shape will canonicalize to a const
with unit value:
  %0 = constant_ranked_shape : !shape.ranked_shape<[1,2],i32>

#### Operands:

| Operand | Description |
| :-----: | ----------- |
`operand` | tensor of any type values

#### Results:

| Result | Description |
| :----: | ----------- |
`shape` | Ranked shape type

### `shapex.make_ranked_shape` (Shape::MakeRankedShapeOp)

Makes a ranked_shape from individual dims.

Syntax:

```
operation ::= `shapex.make_ranked_shape` $dynamic_dimensions `:` functional-type($dynamic_dimensions, $shape) attr-dict
```


Given a list of SSA values holding compatible dims, makes a corresponding
ranked_shape.

Usage:
  %0 = shape.make_ranked_shape %dim0, %dim1 : (i32, i32) ->
      !shape.ranked_shape<[?,?,128]>

Note that the type of the dims is is implied by the dim type of the result.

#### Operands:

| Operand | Description |
| :-----: | ----------- |
`dynamic_dimensions` | index or signless integer

#### Results:

| Result | Description |
| :----: | ----------- |
`shape` | Ranked shape type

### `shapex.ranked_broadcast_in_dim` (Shape::RankedBroadcastInDimOp)

Broadcasts dimensions from the input into the result.

Usage:
  %0 = shape.ranked_broadcast_in_dim [...] (%operand, %result_shp) :
      tensor<...xf32>, !shape.ranked_shape<...xi32>

  Note that the result type will be a RankedTensorType with dims from
  %result_shp and the element type from %operand.

#### Attributes:

| Attribute | MLIR Type | Description |
| :-------: | :-------: | ----------- |
`broadcast_dimensions` | DenseIntElementsAttr | 64-bit signless integer elements attribute

#### Operands:

| Operand | Description |
| :-----: | ----------- |
`operand` | ranked tensor of any type values
`result_shape` | Ranked shape type

#### Results:

| Result | Description |
| :----: | ----------- |
`result` | ranked tensor of any type values

### `shapex.ranked_broadcast_shape` (Shape::RankedBroadcastShapeOp)

Broadcasts operands to a result shape.

Applies numpy broadcasting semantics to shape operands.

Usage:
  %0 = shape.ranked_broadcast_shape %shp0, %shp1 :
      !shape.ranked_shape<...>, !shape.ranked_shape<...>

#### Attributes:

| Attribute | MLIR Type | Description |
| :-------: | :-------: | ----------- |
`lhs_broadcast_dimensions` | DenseIntElementsAttr | 64-bit signless integer elements attribute
`rhs_broadcast_dimensions` | DenseIntElementsAttr | 64-bit signless integer elements attribute

#### Operands:

| Operand | Description |
| :-----: | ----------- |
`lhs` | Ranked shape type
`rhs` | Ranked shape type

#### Results:

| Result | Description |
| :----: | ----------- |
`result` | Ranked shape type

### `shapex.ranked_dim` (Shape::RankedDimOp)

Gets a dimension value from a ranked_shape.

Static dimensions will fold to constants.

Usage:
  %0 = shape.const ranked_shape : !shape.ranked_shape<[1,2]>
  %1 = shape.ranked_dim %0[0] : !shape.ranked_shape<[1,2]> -> i32

#### Attributes:

| Attribute | MLIR Type | Description |
| :-------: | :-------: | ----------- |
`index` | IntegerAttr | arbitrary integer attribute

#### Operands:

| Operand | Description |
| :-----: | ----------- |
`shape` | Ranked shape type

#### Results:

| Result | Description |
| :----: | ----------- |
`result` | index or signless integer

### `shapex.ranked_dims` (Shape::RankedDimsOp)

Gets all dimension values from a ranked_shape.

Syntax:

```
operation ::= `shapex.ranked_dims` $shape `:` type($shape) `->` type($result) attr-dict
```


Static dimensions will fold to constants.

Usage:
  %0 = shape.const ranked_shape : !shape.ranked_shape<[1,2]>
  %1, %2 = shape.ranked_dims %0 : !shape.ranked_shape<[1,2]> -> (i32, i32)

#### Operands:

| Operand | Description |
| :-----: | ----------- |
`shape` | Ranked shape type

#### Results:

| Result | Description |
| :----: | ----------- |
`result` | index or signless integer

### `shapex.tie_shape` (Shape::TieShapeOp)

Ties a tensor and a shape together.

Syntax:

```
operation ::= `shapex.tie_shape` operands attr-dict `:` type($operand) `,` type($shape)
```


Ties a specific tensor and its shape together in the IR, allowing further
conversions to re-associate the two. This has no runtime implication and
will be removed late in conversion.

Usage:
  %0 = shape.tie_shape %1, %2 : tensor<...>, shape.ranked_shape<...>

#### Operands:

| Operand | Description |
| :-----: | ----------- |
`operand` | any type
`shape` | Ranked shape type

#### Results:

| Result | Description |
| :----: | ----------- |
`result` | any type
